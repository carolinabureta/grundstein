<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=My><meta name=author content=Lyz><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.11"><title>SH - The Red Lobster Book</title><link rel=stylesheet href=../assets/stylesheets/main.7e359304.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../css/timeago.css><link rel=stylesheet href=../stylesheets/extra.css><link rel=stylesheet href=../stylesheets/links.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#installation class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> </div> </aside> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="The Red Lobster Book" class="md-header__button md-logo" aria-label="The Red Lobster Book" data-md-component=logo> <img src=../img/logo.bmp alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> The Red Lobster Book </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> SH </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=light-blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/realcaptainsolaris/redbook title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> realcaptainsolaris/redbook </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="The Red Lobster Book" class="md-nav__button md-logo" aria-label="The Red Lobster Book" data-md-component=logo> <img src=../img/logo.bmp alt=logo> </a> The Red Lobster Book </label> <div class=md-nav__source> <a href=https://github.com/realcaptainsolaris/redbook title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> realcaptainsolaris/redbook </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../contact/ class=md-nav__link> <span class=md-ellipsis> Contact </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Uebungen </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Uebungen </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../uebungen/beispiel/ class=md-nav__link> <span class=md-ellipsis> Test1 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#installation class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> <span class=md-ellipsis> Usage </span> </a> <nav class=md-nav aria-label=Usage> <ul class=md-nav__list> <li class=md-nav__item> <a href=#passing-arguments class=md-nav__link> <span class=md-ellipsis> Passing arguments </span> </a> </li> <li class=md-nav__item> <a href=#handling-exceptions class=md-nav__link> <span class=md-ellipsis> Handling exceptions </span> </a> </li> <li class=md-nav__item> <a href=#redirecting-output class=md-nav__link> <span class=md-ellipsis> Redirecting output </span> </a> </li> <li class=md-nav__item> <a href=#running-in-background class=md-nav__link> <span class=md-ellipsis> Running in background </span> </a> <nav class=md-nav aria-label="Running in background"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#output-callbacks class=md-nav__link> <span class=md-ellipsis> Output callbacks </span> </a> </li> <li class=md-nav__item> <a href=#interactive-callbacks class=md-nav__link> <span class=md-ellipsis> Interactive callbacks </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#interacting-with-programs-that-ask-input-from-the-user class=md-nav__link> <span class=md-ellipsis> Interacting with programs that ask input from the user </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#testing class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> </li> <li class=md-nav__item> <a href=#tips class=md-nav__link> <span class=md-ellipsis> Tips </span> </a> <nav class=md-nav aria-label=Tips> <ul class=md-nav__list> <li class=md-nav__item> <a href=#avoid-exception-logging-when-killing-a-background-process class=md-nav__link> <span class=md-ellipsis> Avoid exception logging when killing a background process </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> <span class=md-ellipsis> References </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>SH</h1> <p><a href=https://amoffat.github.io/sh/index.html>sh</a> is a full-fledged subprocess replacement so beautiful that makes you want to cry. It allows you to call any program as if it were a function:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>sh</span> <span class=kn>import</span> <span class=n>ifconfig</span>
<span class=nb>print</span><span class=p>(</span><span class=n>ifconfig</span><span class=p>(</span><span class=s2>&quot;wlan0&quot;</span><span class=p>))</span>
</code></pre></div> <p>Output:</p> <div class=highlight><pre><span></span><code><span class=n>wlan0</span>   <span class=n>Link</span> <span class=n>encap</span><span class=p>:</span><span class=n>Ethernet</span>  <span class=n>HWaddr</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span>
        <span class=n>inet</span> <span class=n>addr</span><span class=p>:</span><span class=mf>192.168.1.100</span>  <span class=n>Bcast</span><span class=p>:</span><span class=mf>192.168.1.255</span>  <span class=n>Mask</span><span class=p>:</span><span class=mf>255.255.255.0</span>
        <span class=n>inet6</span> <span class=n>addr</span><span class=p>:</span> <span class=n>ffff</span><span class=p>::</span><span class=n>ffff</span><span class=p>:</span><span class=n>ffff</span><span class=p>:</span><span class=n>ffff</span><span class=p>:</span><span class=n>fff</span><span class=o>/</span><span class=mi>64</span> <span class=n>Scope</span><span class=p>:</span><span class=n>Link</span>
        <span class=n>UP</span> <span class=n>BROADCAST</span> <span class=n>RUNNING</span> <span class=n>MULTICAST</span>  <span class=n>MTU</span><span class=p>:</span><span class=mi>1500</span>  <span class=n>Metric</span><span class=p>:</span><span class=mi>1</span>
        <span class=n>RX</span> <span class=n>packets</span><span class=p>:</span><span class=mi>0</span> <span class=n>errors</span><span class=p>:</span><span class=mi>0</span> <span class=n>dropped</span><span class=p>:</span><span class=mi>0</span> <span class=n>overruns</span><span class=p>:</span><span class=mi>0</span> <span class=n>frame</span><span class=p>:</span><span class=mi>0</span>
        <span class=n>TX</span> <span class=n>packets</span><span class=p>:</span><span class=mi>0</span> <span class=n>errors</span><span class=p>:</span><span class=mi>0</span> <span class=n>dropped</span><span class=p>:</span><span class=mi>0</span> <span class=n>overruns</span><span class=p>:</span><span class=mi>0</span> <span class=n>carrier</span><span class=p>:</span><span class=mi>0</span>
        <span class=n>collisions</span><span class=p>:</span><span class=mi>0</span> <span class=n>txqueuelen</span><span class=p>:</span><span class=mi>1000</span>
        <span class=n>RX</span> <span class=nb>bytes</span><span class=p>:</span><span class=mi>0</span> <span class=p>(</span><span class=mi>0</span> <span class=n>GB</span><span class=p>)</span>  <span class=n>TX</span> <span class=nb>bytes</span><span class=p>:</span><span class=mi>0</span> <span class=p>(</span><span class=mi>0</span> <span class=n>GB</span><span class=p>)</span>
</code></pre></div> <p>Note that these aren't Python functions, these are running the binary commands on your system by dynamically resolving your $PATH, much like Bash does, and then wrapping the binary in a function. In this way, all the programs on your system are available to you from within Python.</p> <h2 id=installation>Installation<a class=headerlink href=#installation title="Permanent link">⚑</a></h2> <div class=highlight><pre><span></span><code>pip<span class=w> </span>install<span class=w> </span>sh
</code></pre></div> <h2 id=usage>Usage<a class=headerlink href=#usage title="Permanent link">⚑</a></h2> <h3 id=passing-arguments>Passing arguments<a class=headerlink href=#passing-arguments title="Permanent link">⚑</a></h3> <div class=highlight><pre><span></span><code><span class=n>sh</span><span class=o>.</span><span class=n>ls</span><span class=p>(</span><span class=s2>&quot;-l&quot;</span><span class=p>,</span> <span class=s2>&quot;/tmp&quot;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s2>&quot;never&quot;</span><span class=p>)</span>
</code></pre></div> <p>If the command gives you a syntax error (like <code>pass</code>), you can use bash.</p> <div class=highlight><pre><span></span><code><span class=n>sh</span><span class=o>.</span><span class=n>bash</span><span class=p>(</span><span class=s2>&quot;-c&quot;</span><span class=p>,</span> <span class=s2>&quot;pass&quot;</span><span class=p>)</span>
</code></pre></div> <h3 id=handling-exceptions><a href=https://amoffat.github.io/sh/sections/exit_codes.html>Handling exceptions</a><a class=headerlink href=#handling-exceptions title="Permanent link">⚑</a></h3> <p>Normal processes exit with exit code 0. You can access the program return code with <code>RunningCommand.exit_code</code>:</p> <div class=highlight><pre><span></span><code><span class=n>output</span> <span class=o>=</span> <span class=n>ls</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>output</span><span class=o>.</span><span class=n>exit_code</span><span class=p>)</span> <span class=c1># should be 0</span>
</code></pre></div> <p>If a process terminates, and the exit code is not 0, sh generates an exception dynamically. This lets you catch a specific return code, or catch all error return codes through the base class <code>ErrorReturnCode</code>:</p> <div class=highlight><pre><span></span><code><span class=k>try</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>ls</span><span class=p>(</span><span class=s2>&quot;/some/non-existant/folder&quot;</span><span class=p>))</span>
<span class=k>except</span> <span class=n>sh</span><span class=o>.</span><span class=n>ErrorReturnCode_2</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;folder doesn&#39;t exist!&quot;</span><span class=p>)</span>
    <span class=n>create_the_folder</span><span class=p>()</span>
<span class=k>except</span> <span class=n>sh</span><span class=o>.</span><span class=n>ErrorReturnCode</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;unknown error&quot;</span><span class=p>)</span>
</code></pre></div> <p>The exception object is an sh command object, which has, between other , the <code>stderr</code> and <code>stdout</code> bytes attributes with the errors. To show them use:</p> <div class=highlight><pre><span></span><code><span class=k>except</span> <span class=n>sh</span><span class=o>.</span><span class=n>ErrorReturnCode</span> <span class=k>as</span> <span class=n>error</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>error</span><span class=o>.</span><span class=n>stderr</span><span class=p>,</span> <span class=s1>&#39;utf8&#39;</span><span class=p>))</span>
</code></pre></div> <h3 id=redirecting-output><a href=https://amoffat.github.io/sh/sections/redirection.html>Redirecting output</a><a class=headerlink href=#redirecting-output title="Permanent link">⚑</a></h3> <div class=highlight><pre><span></span><code><span class=n>sh</span><span class=o>.</span><span class=n>ifconfig</span><span class=p>(</span><span class=n>_out</span><span class=o>=</span><span class=s2>&quot;/tmp/interfaces&quot;</span><span class=p>)</span>
</code></pre></div> <h3 id=running-in-background><a href="https://amoffat.github.io/sh/sections/asynchronous_execution.html?highlight=background#background-processes">Running in background</a><a class=headerlink href=#running-in-background title="Permanent link">⚑</a></h3> <p>By default, each running command blocks until completion. If you have a long-running command, you can put it in the background with the <code>_bg=True</code> special kwarg:</p> <div class=highlight><pre><span></span><code><span class=c1># blocks</span>
<span class=n>sleep</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=s2>&quot;...3 seconds later&quot;</span><span class=p>)</span>

<span class=c1># doesn&#39;t block</span>
<span class=n>p</span> <span class=o>=</span> <span class=n>sleep</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=n>_bg</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=s2>&quot;prints immediately!&quot;</span><span class=p>)</span>
<span class=n>p</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
<span class=nb>print</span><span class=p>(</span><span class=s2>&quot;...and 3 seconds later&quot;</span><span class=p>)</span>
</code></pre></div> <p>You’ll notice that you need to call <code>RunningCommand.wait()</code> in order to exit after your command exits.</p> <p>Commands launched in the background ignore <code>SIGHUP</code>, meaning that when their controlling process (the session leader, if there is a controlling terminal) exits, they will not be signalled by the kernel. But because <code>sh</code> commands launch their processes in their own sessions by default, meaning they are their own session leaders, ignoring <code>SIGHUP</code> will normally have no impact. So the only time ignoring <code>SIGHUP</code> will do anything is if you use <code>_new_session=False</code>, in which case the controlling process will probably be the shell from which you launched python, and exiting that shell would normally send a <code>SIGHUP</code> to all child processes.</p> <p>If you want to terminate the process use <code>p.kill()</code>.</p> <h4 id=output-callbacks><a href="https://amoffat.github.io/sh/sections/asynchronous_execution.html?highlight=background#output-callbacks">Output callbacks</a><a class=headerlink href=#output-callbacks title="Permanent link">⚑</a></h4> <p>In combination with <code>_bg=True</code>, <code>sh</code> can use callbacks to process output incrementally by passing a callable function to <code>_out</code> and/or <code>_err</code>. This callable will be called for each line (or chunk) of data that your command outputs:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>sh</span> <span class=kn>import</span> <span class=n>tail</span>

<span class=k>def</span> <span class=nf>process_output</span><span class=p>(</span><span class=n>line</span><span class=p>):</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>

<span class=n>p</span> <span class=o>=</span> <span class=n>tail</span><span class=p>(</span><span class=s2>&quot;-f&quot;</span><span class=p>,</span> <span class=s2>&quot;/var/log/some_log_file.log&quot;</span><span class=p>,</span> <span class=n>_out</span><span class=o>=</span><span class=n>process_output</span><span class=p>,</span> <span class=n>_bg</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=n>p</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</code></pre></div> <p>To “quit” your callback, simply <code>return True</code>. This tells the command not to call your callback anymore. This does not kill the process though see <a href=#interactive-callbacks>Interactive callbacks</a> for how to kill a process from a callback.</p> <p>The line or chunk received by the callback can either be of type str or bytes. If the output could be decoded using the provided encoding, a str will be passed to the callback, otherwise it would be raw bytes.</p> <h4 id=interactive-callbacks><a href="https://amoffat.github.io/sh/sections/asynchronous_execution.html?highlight=background#interactive-callbacks">Interactive callbacks</a><a class=headerlink href=#interactive-callbacks title="Permanent link">⚑</a></h4> <p>Commands may communicate with the underlying process interactively through a specific callback signature. Each command launched through <code>sh</code> has an internal STDIN <code>queue.Queue</code> that can be used from callbacks:</p> <div class=highlight><pre><span></span><code>    <span class=k>def</span> <span class=nf>interact</span><span class=p>(</span><span class=n>line</span><span class=p>,</span> <span class=n>stdin</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>line</span> <span class=o>==</span> <span class=s2>&quot;What... is the air-speed velocity of an unladen swallow?&quot;</span><span class=p>:</span>
            <span class=n>stdin</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&quot;What do you mean? An African or European swallow?&quot;</span><span class=p>)</span>

        <span class=k>elif</span> <span class=n>line</span> <span class=o>==</span> <span class=s2>&quot;Huh? I... I don&#39;t know that....AAAAGHHHHHH&quot;</span><span class=p>:</span>
            <span class=n>cross_bridge</span><span class=p>()</span>
            <span class=k>return</span> <span class=kc>True</span>

        <span class=k>else</span><span class=p>:</span>
            <span class=n>stdin</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&quot;I don&#39;t know....AAGGHHHHH&quot;</span><span class=p>)</span>
            <span class=k>return</span> <span class=kc>True</span>

    <span class=n>p</span> <span class=o>=</span> <span class=n>sh</span><span class=o>.</span><span class=n>bridgekeeper</span><span class=p>(</span><span class=n>_out</span><span class=o>=</span><span class=n>interact</span><span class=p>,</span> <span class=n>_bg</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=n>p</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</code></pre></div> <p>You can also kill or terminate your process (or send any signal, really) from your callback by adding a third argument to receive the process object:</p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>process_output</span><span class=p>(</span><span class=n>line</span><span class=p>,</span> <span class=n>stdin</span><span class=p>,</span> <span class=n>process</span><span class=p>):</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
    <span class=k>if</span> <span class=s2>&quot;ERROR&quot;</span> <span class=ow>in</span> <span class=n>line</span><span class=p>:</span>
        <span class=n>process</span><span class=o>.</span><span class=n>kill</span><span class=p>()</span>
        <span class=k>return</span> <span class=kc>True</span>

<span class=n>p</span> <span class=o>=</span> <span class=n>tail</span><span class=p>(</span><span class=s2>&quot;-f&quot;</span><span class=p>,</span> <span class=s2>&quot;/var/log/some_log_file.log&quot;</span><span class=p>,</span> <span class=n>_out</span><span class=o>=</span><span class=n>process_output</span><span class=p>,</span> <span class=n>_bg</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div> <p>The above code will run, printing lines from <code>some_log_file.log</code> until the word <code>ERROR</code> appears in a line, at which point the tail process will be killed and the script will end.</p> <h3 id=interacting-with-programs-that-ask-input-from-the-user>Interacting with programs that ask input from the user<a class=headerlink href=#interacting-with-programs-that-ask-input-from-the-user title="Permanent link">⚑</a></h3> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Check <a href="https://amoffat.github.io/sh/sections/asynchronous_execution.html?highlight=background#interactive-callbacks">the interactive callbacks</a> or <a href=https://github.com/amoffat/sh/issues/543>this issue</a>, as it looks like a cleaner solution.</p> </div> <p><code>sh</code> allows you to interact with programs that asks for user input. The documentation is not clear on how to do it, but between the <a href=https://amoffat.github.io/sh/sections/redirection.html#function-callback>function callbacks</a> documentation, and the example on <a href=https://amoffat.github.io/sh/tutorials/interacting_with_processes.html#entering-an-ssh-password>how to enter an SSH password</a> we can deduce how to do it.</p> <p>Imagine we've got a python script that asks the user to enter a username so it can save it in a file.</p> <div class="admonition note"> <p class=admonition-title>File: /tmp/script.py</p> <div class=highlight><pre><span></span><code><span class=n>answer</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&quot;Enter username: &quot;</span><span class=p>)</span>

<span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&quot;/tmp/user.txt&quot;</span><span class=p>,</span> <span class=s2>&quot;w+&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>answer</span><span class=p>)</span>
</code></pre></div> </div> <p>When we run it in the terminal we get prompted and answer with <code>lyz</code>:</p> <div class=highlight><pre><span></span><code>$:<span class=w> </span>/tmp/script.py
Enter<span class=w> </span>username:<span class=w> </span>lyz

$:<span class=w> </span>cat<span class=w> </span>/tmp/user.txt
lyz
</code></pre></div> <p>To achieve the same goal automatically with <code>sh</code> we'll need to use the function callbacks. They are functions we pass to the sh command through the <code>_out</code> argument.</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>sys</span>
<span class=kn>import</span> <span class=nn>re</span>

<span class=n>aggregated</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>

<span class=k>def</span> <span class=nf>interact</span><span class=p>(</span><span class=n>char</span><span class=p>,</span> <span class=n>stdin</span><span class=p>):</span>
    <span class=k>global</span> <span class=n>aggregated</span>
    <span class=n>sys</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>char</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span>
    <span class=n>sys</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
    <span class=n>aggregated</span> <span class=o>+=</span> <span class=n>char</span>
    <span class=k>if</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;Enter username: &quot;</span><span class=p>,</span> <span class=n>aggregated</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=p>):</span>
        <span class=n>stdin</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&quot;lyz</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>

<span class=n>sh</span><span class=o>.</span><span class=n>bash</span><span class=p>(</span>
    <span class=s2>&quot;-c&quot;</span><span class=p>,</span>
    <span class=s2>&quot;/tmp/script.py&quot;</span><span class=p>,</span>
    <span class=n>_out</span><span class=o>=</span><span class=n>interact</span><span class=p>,</span>
    <span class=n>_out_bufsize</span><span class=o>=</span><span class=mi>0</span>
<span class=p>)</span>
</code></pre></div> <p>In the example above we've created an <code>interact</code> function that will get called on each character of the stdout of the command. It will be called on each character because we passed the argument <code>_out_bufsize=0</code>. Check the <a href=https://amoffat.github.io/sh/tutorials/interacting_with_processes.html#entering-an-ssh-password>ssh password example</a> to see why we need that.</p> <p>As it's run on each character, and we need to input the username once the program is expecting us to enter the input and not before, we need to keep track of all the printed characters through the global <code>aggregated</code> variable. Once the regular expression matches what we want, sh will inject the desired value.</p> <div class="admonition warning"> <p>Remember to add the <code>\n</code> at the end of the string you want to inject.</p> </div> <p>If the output never matches the regular expression, you'll enter an endless loop, so you need to know before hand all the possible user input prompts.</p> <h2 id=testing><a href=https://amoffat.github.io/sh/sections/faq.html#how-do-i-patch-sh-in-my-tests>Testing</a><a class=headerlink href=#testing title="Permanent link">⚑</a></h2> <p><code>sh</code> can be patched in your tests the typical way, with <code>unittest.mock.patch()</code>:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>unittest.mock</span> <span class=kn>import</span> <span class=n>patch</span>
<span class=kn>import</span> <span class=nn>sh</span>

<span class=k>def</span> <span class=nf>get_something</span><span class=p>():</span>
    <span class=k>return</span> <span class=n>sh</span><span class=o>.</span><span class=n>pwd</span><span class=p>()</span>

<span class=nd>@patch</span><span class=p>(</span><span class=s2>&quot;sh.pwd&quot;</span><span class=p>,</span> <span class=n>create</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>test_something</span><span class=p>(</span><span class=n>pwd</span><span class=p>):</span>
    <span class=n>pwd</span><span class=o>.</span><span class=n>return_value</span> <span class=o>=</span> <span class=s2>&quot;/&quot;</span>
    <span class=k>assert</span> <span class=n>get_something</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&quot;/&quot;</span>
</code></pre></div> <p>The important thing to note here is that <code>create=True</code> is set. This is required because <code>sh</code> is a bit magical and patch will fail to find the <code>pwd</code> command as an attribute on the <code>sh</code> module.</p> <p>You may also patch the <code>Command</code> class:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>unittest.mock</span> <span class=kn>import</span> <span class=n>patch</span>
<span class=kn>import</span> <span class=nn>sh</span>

<span class=k>def</span> <span class=nf>get_something</span><span class=p>():</span>
    <span class=n>pwd</span> <span class=o>=</span> <span class=n>sh</span><span class=o>.</span><span class=n>Command</span><span class=p>(</span><span class=s2>&quot;pwd&quot;</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>pwd</span><span class=p>()</span>

<span class=nd>@patch</span><span class=p>(</span><span class=s2>&quot;sh.Command&quot;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>test_something</span><span class=p>(</span><span class=n>Command</span><span class=p>):</span>
    <span class=n>Command</span><span class=p>()</span><span class=o>.</span><span class=n>return_value</span> <span class=o>=</span> <span class=s2>&quot;/&quot;</span>
    <span class=k>assert</span> <span class=n>get_something</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&quot;/&quot;</span>
</code></pre></div> <p>Notice here we do not need <code>create=True</code>, because <code>Command</code> is not an automatically generated object on the <code>sh</code> module (it actually exists).</p> <h2 id=tips>Tips<a class=headerlink href=#tips title="Permanent link">⚑</a></h2> <h3 id=avoid-exception-logging-when-killing-a-background-process><a href=https://stackoverflow.com/questions/44936743/using-the-sh-python-module-avoid-exception-logging-when-killing-a-background-pr>Avoid exception logging when killing a background process</a><a class=headerlink href=#avoid-exception-logging-when-killing-a-background-process title="Permanent link">⚑</a></h3> <p>In order to catch this exception execute your process with <code>_bg_exec=False</code> and execute <code>p.wait()</code> if you want to handle the exception. Otherwise don't use the <code>p.wait()</code>.</p> <div class=highlight><pre><span></span><code><span class=n>p</span> <span class=o>=</span> <span class=n>sh</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=n>_bg</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>_bg_exc</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<span class=k>try</span><span class=p>:</span>
    <span class=n>p</span><span class=o>.</span><span class=n>kill</span><span class=p>()</span>
    <span class=n>p</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
<span class=k>except</span> <span class=n>sh</span><span class=o>.</span><span class=n>SignalException_SIGKILL</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;foo&quot;</span><span class=p>)</span>

<span class=n>foo</span>
</code></pre></div> <h2 id=references>References<a class=headerlink href=#references title="Permanent link">⚑</a></h2> <ul> <li><a href=https://amoffat.github.io/sh/index.html>Docs</a></li> <li><a href=https://github.com/amoffat/sh>Git</a></li> </ul> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2024-08-30T08:35:48+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-08-30</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/benkyonodo target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.instant", "navigation.top", "content.code.annotate", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.8fd75fb4.min.js></script> <script src=../js/timeago.min.js></script> <script src=../js/timeago_mkdocs_material.js></script> </body> </html>