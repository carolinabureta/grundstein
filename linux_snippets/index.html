<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=My><meta name=author content=Lyz><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.11"><title>Linux snippets - The Red Lobster Book</title><link rel=stylesheet href=../assets/stylesheets/main.7e359304.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../css/timeago.css><link rel=stylesheet href=../stylesheets/extra.css><link rel=stylesheet href=../stylesheets/links.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#df-and-du-showing-different-results class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> </div> </aside> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="The Red Lobster Book" class="md-header__button md-logo" aria-label="The Red Lobster Book" data-md-component=logo> <img src=../img/logo.bmp alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> The Red Lobster Book </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Linux snippets </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=light-blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/realcaptainsolaris/redbook title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> realcaptainsolaris/redbook </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="The Red Lobster Book" class="md-nav__button md-logo" aria-label="The Red Lobster Book" data-md-component=logo> <img src=../img/logo.bmp alt=logo> </a> The Red Lobster Book </label> <div class=md-nav__source> <a href=https://github.com/realcaptainsolaris/redbook title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> realcaptainsolaris/redbook </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../contact/ class=md-nav__link> <span class=md-ellipsis> Contact </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Uebungen </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Uebungen </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../uebungen/beispiel/ class=md-nav__link> <span class=md-ellipsis> Test1 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#df-and-du-showing-different-results class=md-nav__link> <span class=md-ellipsis> df and du showing different results </span> </a> <nav class=md-nav aria-label="df and du showing different results"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#disk-mounted-over-data class=md-nav__link> <span class=md-ellipsis> Disk mounted over data </span> </a> </li> <li class=md-nav__item> <a href=#used-deleted-files class=md-nav__link> <span class=md-ellipsis> Used deleted files </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#scan-a-physical-page-in-linux class=md-nav__link> <span class=md-ellipsis> Scan a physical page in Linux </span> </a> </li> <li class=md-nav__item> <a href=#git-checkout-to-main-with-master-as-a-fallback class=md-nav__link> <span class=md-ellipsis> Git checkout to main with master as a fallback </span> </a> </li> <li class=md-nav__item> <a href=#create-qr-code class=md-nav__link> <span class=md-ellipsis> Create QR code </span> </a> </li> <li class=md-nav__item> <a href=#trim-silences-of-sound-files class=md-nav__link> <span class=md-ellipsis> Trim silences of sound files </span> </a> </li> <li class=md-nav__item> <a href=#adjust-the-replay-gain-of-many-sound-files class=md-nav__link> <span class=md-ellipsis> Adjust the replay gain of many sound files </span> </a> </li> <li class=md-nav__item> <a href=#check-vulnerabilities-in-nodejs-applications class=md-nav__link> <span class=md-ellipsis> Check vulnerabilities in Node.js applications </span> </a> </li> <li class=md-nav__item> <a href=#check-vulnerabilities-in-rails-dependencies class=md-nav__link> <span class=md-ellipsis> Check vulnerabilities in rails dependencies </span> </a> </li> <li class=md-nav__item> <a href=#create-basic-auth-header class=md-nav__link> <span class=md-ellipsis> Create Basic Auth header </span> </a> </li> <li class=md-nav__item> <a href=#install-one-package-from-debian-unstable class=md-nav__link> <span class=md-ellipsis> Install one package from Debian unstable </span> </a> </li> <li class=md-nav__item> <a href=#fix-the-following-packages-have-been-kept-back class=md-nav__link> <span class=md-ellipsis> Fix the following packages have been kept back </span> </a> </li> <li class=md-nav__item> <a href=#monitor-outgoing-traffic class=md-nav__link> <span class=md-ellipsis> Monitor outgoing traffic </span> </a> <nav class=md-nav aria-label="Monitor outgoing traffic"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#easy-and-quick-way-watch-lsof class=md-nav__link> <span class=md-ellipsis> Easy and quick way watch &amp; lsof </span> </a> </li> <li class=md-nav__item> <a href=#fine-grained-with-tcpdump class=md-nav__link> <span class=md-ellipsis> Fine grained with tcpdump </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#clean-up-system-space class=md-nav__link> <span class=md-ellipsis> Clean up system space </span> </a> <nav class=md-nav aria-label="Clean up system space"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#clean-package-data class=md-nav__link> <span class=md-ellipsis> Clean package data </span> </a> </li> <li class=md-nav__item> <a href=#clean-snap-data class=md-nav__link> <span class=md-ellipsis> Clean snap data </span> </a> </li> <li class=md-nav__item> <a href=#clean-journalctl-data class=md-nav__link> <span class=md-ellipsis> Clean journalctl data </span> </a> </li> <li class=md-nav__item> <a href=#clean-up-docker-data class=md-nav__link> <span class=md-ellipsis> Clean up docker data </span> </a> <nav class=md-nav aria-label="Clean up docker data"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#set-up-docker-logs-rotation class=md-nav__link> <span class=md-ellipsis> Set up docker logs rotation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#clean-old-kernels class=md-nav__link> <span class=md-ellipsis> Clean old kernels </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#replace-a-string-with-sed-recursively class=md-nav__link> <span class=md-ellipsis> Replace a string with sed recursively </span> </a> </li> <li class=md-nav__item> <a href=#bypass-client-ssl-certificate-with-cli-tool class=md-nav__link> <span class=md-ellipsis> Bypass client SSL certificate with cli tool </span> </a> </li> <li class=md-nav__item> <a href=#allocate-space-for-a-virtual-filesystem class=md-nav__link> <span class=md-ellipsis> Allocate space for a virtual filesystem </span> </a> </li> <li class=md-nav__item> <a href=#identify-what-a-string-or-file-contains class=md-nav__link> <span class=md-ellipsis> Identify what a string or file contains </span> </a> </li> <li class=md-nav__item> <a href=#split-a-file-into-many-with-equal-number-of-lines class=md-nav__link> <span class=md-ellipsis> Split a file into many with equal number of lines </span> </a> </li> <li class=md-nav__item> <a href=#check-if-an-rsync-command-has-gone-well class=md-nav__link> <span class=md-ellipsis> Check if an rsync command has gone well </span> </a> </li> <li class=md-nav__item> <a href=#list-all-process-swap-usage class=md-nav__link> <span class=md-ellipsis> List all process swap usage </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Linux snippets</h1> <h2 id=df-and-du-showing-different-results><a href=https://www.cyberciti.biz/tips/freebsd-why-command-df-and-du-reports-different-output.html>df and du showing different results</a><a class=headerlink href=#df-and-du-showing-different-results title="Permanent link">⚑</a></h2> <p>Sometimes on a linux machine you will notice that both <code>df</code> command (display free disk space) and <code>du</code> command (display disk usage statistics) report different output. Usually, <code>df</code> will output a bigger disk usage than <code>du</code>.</p> <p>The <code>du</code> command estimates file space usage, and the <code>df</code> command shows file system disk space usage.</p> <p>There are many reasons why this could be happening:</p> <h3 id=disk-mounted-over-data>Disk mounted over data<a class=headerlink href=#disk-mounted-over-data title="Permanent link">⚑</a></h3> <p>If you mount a disk on a directory that already holds data, then when you run <code>du</code> that data won't show, but <code>df</code> knows it's there.</p> <p>To troubleshoot this, umount one by one of your disks, and do an <code>ls</code> to see if there's any remaining data in the mount point.</p> <h3 id=used-deleted-files>Used deleted files<a class=headerlink href=#used-deleted-files title="Permanent link">⚑</a></h3> <p>When a file is deleted under Unix/Linux, the disk space occupied by the file will not be released immediately in some cases. The result of the command <code>du</code> doesn’t include the size of the deleting file. But the impact of the command <code>df</code> for the deleting file’s size due to its disk space is not released immediately. Hence, after deleting the file, the results of <code>df</code> and <code>du</code> are different until the disk space is freed.</p> <p>Open file descriptor is main causes of such wrong information. For example, if a file called <code>/tmp/application.log</code> is open by a third-party application OR by a user and the same file is deleted, both <code>df</code> and <code>du</code> report different outputs. You can use the <code>lsof</code> command to verify this:</p> <div class=highlight><pre><span></span><code>lsof<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>tmp
</code></pre></div> <p>To fix it:</p> <ul> <li>Use the <code>lsof</code> command as discussed above to find a deleted file opened by other users and apps. See how to list all users in the system for more info.</li> <li>Then, close those apps and log out of those Linux and Unix users.</li> <li>As a sysadmin you restart any process or <code>kill</code> the process under Linux and Unix that did not release the deleted file.</li> <li>Flush the filesystem using the <code>sync</code> command that synchronizes cached writes to persistent disk storage.</li> <li>If everything else fails, try restarting the system using the <code>reboot</code> command or <code>shutdown</code> command.</li> </ul> <h2 id=scan-a-physical-page-in-linux>Scan a physical page in Linux<a class=headerlink href=#scan-a-physical-page-in-linux title="Permanent link">⚑</a></h2> <p>Install <code>xsane</code> and run it.</p> <h2 id=git-checkout-to-main-with-master-as-a-fallback><a href=https://stackoverflow.com/questions/66232497/git-alias-which-works-for-main-or-master-or-other>Git checkout to main with master as a fallback</a><a class=headerlink href=#git-checkout-to-main-with-master-as-a-fallback title="Permanent link">⚑</a></h2> <p>I usually use the alias <code>gcm</code> to change to the main branch of the repository, given the change from <a href=../git/#renaming-from-master-to-main>main to master</a> now I have some repos that use one or the other, but I still want <code>gcm</code> to go to the correct one. The solution is to use:</p> <div class=highlight><pre><span></span><code><span class=nb>alias</span><span class=w> </span><span class=nv>gcm</span><span class=o>=</span><span class=s1>&#39;git checkout &quot;$(git symbolic-ref refs/remotes/origin/HEAD | cut -d&#39;</span>/<span class=s1>&#39; -f4)&quot;&#39;</span>
</code></pre></div> <h2 id=create-qr-code><a href=https://www.linux-magazine.com/Online/Features/Generating-QR-Codes-in-Linux>Create QR code</a><a class=headerlink href=#create-qr-code title="Permanent link">⚑</a></h2> <div class=highlight><pre><span></span><code>qrencode<span class=w> </span>-o<span class=w> </span>qrcode.png<span class=w> </span><span class=s1>&#39;Hello World!&#39;</span>
</code></pre></div> <h2 id=trim-silences-of-sound-files><a href=https://digitalcardboard.com/blog/2009/08/25/the-sox-of-silence/ >Trim silences of sound files</a><a class=headerlink href=#trim-silences-of-sound-files title="Permanent link">⚑</a></h2> <p>To trim all silence longer than 2 seconds down to only 2 seconds long.</p> <div class=highlight><pre><span></span><code>sox<span class=w> </span><span class=k>in</span>.wav<span class=w> </span>out6.wav<span class=w> </span>silence<span class=w> </span>-l<span class=w> </span><span class=m>1</span><span class=w> </span><span class=m>0</span>.1<span class=w> </span><span class=m>1</span>%<span class=w> </span>-1<span class=w> </span><span class=m>2</span>.0<span class=w> </span><span class=m>1</span>%
</code></pre></div> <p>Note that SoX does nothing to bits of silence shorter than 2 seconds.</p> <p>If you encounter the <code>sox FAIL formats: no handler for file extension 'mp3'</code> error you'll need to install the <code>libsox-fmt-all</code> package.</p> <h2 id=adjust-the-replay-gain-of-many-sound-files><a href=https://askubuntu.com/questions/246242/how-to-normalize-sound-in-mp3-files>Adjust the replay gain of many sound files</a><a class=headerlink href=#adjust-the-replay-gain-of-many-sound-files title="Permanent link">⚑</a></h2> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>python-rgain
replaygain<span class=w> </span>-f<span class=w> </span>*.mp3
</code></pre></div> <h2 id=check-vulnerabilities-in-nodejs-applications>Check vulnerabilities in Node.js applications<a class=headerlink href=#check-vulnerabilities-in-nodejs-applications title="Permanent link">⚑</a></h2> <p>With <code>yarn audit</code> you'll see the vulnerabilities, with <code>yarn outdated</code> you can see the packages that you need to update.</p> <h2 id=check-vulnerabilities-in-rails-dependencies><a href=https://github.com/rubysec/bundler-audit>Check vulnerabilities in rails dependencies</a><a class=headerlink href=#check-vulnerabilities-in-rails-dependencies title="Permanent link">⚑</a></h2> <div class=highlight><pre><span></span><code>gem<span class=w> </span>install<span class=w> </span>bundler-audit
<span class=nb>cd</span><span class=w> </span>project_with_gem_lock
bundler-audit
</code></pre></div> <h2 id=create-basic-auth-header><a href=https://majgis.github.io/2017/09/13/Create-Authorization-Basic-Header/ >Create Basic Auth header</a><a class=headerlink href=#create-basic-auth-header title="Permanent link">⚑</a></h2> <div class=highlight><pre><span></span><code>$<span class=w> </span><span class=nb>echo</span><span class=w> </span>-n<span class=w> </span>user:password<span class=w> </span><span class=p>|</span><span class=w> </span>base64
<span class=nv>dXNlcjpwYXNzd29yZA</span><span class=o>==</span>
</code></pre></div> <p>Without the <code>-n</code> it won't work well.</p> <h2 id=install-one-package-from-debian-unstable><a href=https://linuxaria.com/howto/how-to-install-a-single-package-from-debian-sid-or-debian-testing>Install one package from Debian unstable</a><a class=headerlink href=#install-one-package-from-debian-unstable title="Permanent link">⚑</a></h2> <ul> <li>Add the <code>unstable</code> repository to your <code>/etc/apt/sources.list</code></li> </ul> <div class=highlight><pre><span></span><code><span class=c1># Unstable</span>
deb<span class=w> </span>http://deb.debian.org/debian/<span class=w> </span>unstable<span class=w> </span>main<span class=w> </span>contrib<span class=w> </span>non-free
deb-src<span class=w> </span>http://deb.debian.org/debian/<span class=w> </span>unstable<span class=w> </span>main<span class=w> </span>contrib<span class=w> </span>non-free
</code></pre></div> <ul> <li>Configure <code>apt</code> to only use <code>unstable</code> when specified</li> </ul> <p>!!! note "File: <code>/etc/apt/preferences</code>" ``` Package: * Pin: release a=stable Pin-Priority: 700</p> <div class=highlight><pre><span></span><code>Package: *
Pin: release  a=testing
Pin-Priority: 600

Package: *
Pin: release a=unstable
Pin-Priority: 100
```
</code></pre></div> <ul> <li>Update the package data with <code>apt-get update</code>.</li> <li>See that the new versions are available with <code>apt-cache policy &lt;package_name&gt;</code></li> <li>To install a package from unstable you can run <code>apt-get install -t unstable &lt;package_name&gt;</code>.</li> </ul> <h2 id=fix-the-following-packages-have-been-kept-back><a href=https://askubuntu.com/questions/601/the-following-packages-have-been-kept-back-why-and-how-do-i-solve-it>Fix the following packages have been kept back</a><a class=headerlink href=#fix-the-following-packages-have-been-kept-back title="Permanent link">⚑</a></h2> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>apt-get<span class=w> </span>--with-new-pkgs<span class=w> </span>upgrade
</code></pre></div> <h2 id=monitor-outgoing-traffic><a href=https://fedingo.com/how-to-monitor-outgoing-http-requests-in-linux/ >Monitor outgoing traffic</a><a class=headerlink href=#monitor-outgoing-traffic title="Permanent link">⚑</a></h2> <h3 id=easy-and-quick-way-watch-lsof>Easy and quick way watch &amp; lsof<a class=headerlink href=#easy-and-quick-way-watch-lsof title="Permanent link">⚑</a></h3> <p>You can simply use a combination of <code>watch</code> &amp; <code>lsof</code> command in Linux to get an idea of outgoing traffic on specific ports. Here is an example of outgoing traffic on ports <code>80</code> and <code>443</code>.</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>watch<span class=w> </span>-n1<span class=w> </span>lsof<span class=w> </span>-i<span class=w> </span>TCP:80,443
</code></pre></div> <p>Here is a sample output.</p> <div class=highlight><pre><span></span><code>dropbox<span class=w>    </span><span class=m>2280</span><span class=w> </span>saml<span class=w>   </span>23u<span class=w>  </span>IPv4<span class=w> </span><span class=m>56015285</span><span class=w>      </span>0t0<span class=w>  </span>TCP<span class=w> </span>www.example.local:56003-&gt;snt-re3-6c.sjc.dropbox.com:http<span class=w> </span><span class=o>(</span>ESTABLISHED<span class=o>)</span>
thunderbi<span class=w>  </span><span class=m>2306</span><span class=w> </span>saml<span class=w>   </span>60u<span class=w>  </span>IPv4<span class=w> </span><span class=m>56093767</span><span class=w>      </span>0t0<span class=w>  </span>TCP<span class=w> </span>www.example.local:34788-&gt;ord08s09-in-f20.1e100.net:https<span class=w> </span><span class=o>(</span>ESTABLISHED<span class=o>)</span>
mono<span class=w>       </span><span class=m>2322</span><span class=w> </span>saml<span class=w>   </span>15u<span class=w>  </span>IPv4<span class=w> </span><span class=m>56012349</span><span class=w>      </span>0t0<span class=w>  </span>TCP<span class=w> </span>www.example.local:54018-&gt;204-62-14-135.static.6sync.net:https<span class=w> </span><span class=o>(</span>ESTABLISHED<span class=o>)</span>
chrome<span class=w>    </span><span class=m>4068</span><span class=w> </span>saml<span class=w>  </span>175u<span class=w>  </span>IPv4<span class=w> </span><span class=m>56021419</span><span class=w>      </span>0t0<span class=w>  </span>TCP<span class=w> </span>www.example.local:42182-&gt;stackoverflow.com:http<span class=w> </span><span class=o>(</span>ESTABLISHED<span class=o>)</span>
</code></pre></div> <p>You'll miss the short lived connections though.</p> <h3 id=fine-grained-with-tcpdump>Fine grained with tcpdump<a class=headerlink href=#fine-grained-with-tcpdump title="Permanent link">⚑</a></h3> <p>You can also use <code>tcpdump</code> command to capture all raw packets, on all interfaces, on all ports, and write them to file.</p> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>tcpdump<span class=w> </span>-tttt<span class=w> </span>-i<span class=w> </span>any<span class=w> </span>-w<span class=w> </span>/tmp/http.log
</code></pre></div> <p>Or you can limit it to a specific port adding the arguments <code>port 443 or 80</code>. The <code>-tttt</code> flag is used to capture the packets with a human readable timestamp.</p> <p>To read the recorded information, run the <code>tcpdump</code> command with <code>-A</code> option. It will print ASCII text in recorded packets, that you can browse using page up/down keys.</p> <div class=highlight><pre><span></span><code>tcpdump<span class=w> </span>-A<span class=w> </span>-r<span class=w> </span>/tmp/http.log<span class=w> </span><span class=p>|</span><span class=w> </span>less
</code></pre></div> <p>However, <code>tcpdump</code> cannot decrypt information, so you cannot view information about HTTPS requests in it.</p> <h2 id=clean-up-system-space><a href=https://ownyourbits.com/2017/02/18/squeeze-disk-space-on-a-debian-system/ >Clean up system space</a><a class=headerlink href=#clean-up-system-space title="Permanent link">⚑</a></h2> <h3 id=clean-package-data>Clean package data<a class=headerlink href=#clean-package-data title="Permanent link">⚑</a></h3> <p>There is a couple of things to do when we want to free space in a no-brainer way. First, we want to remove those deb packages that get cached every time we do <code>apt-get install</code>.</p> <div class=highlight><pre><span></span><code>apt-get<span class=w> </span>clean
</code></pre></div> <p>Also, the system might keep packages that were downloaded as dependencies but are not needed anymore. We can get rid of them with</p> <div class=highlight><pre><span></span><code>apt-get<span class=w> </span>autoremove
</code></pre></div> <p>Remove <a href=https://askubuntu.com/questions/687295/how-to-purge-previously-only-removed-packages>data of unpurged packages</a>.</p> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>apt-get<span class=w> </span>purge<span class=w> </span><span class=k>$(</span>dpkg<span class=w> </span>-l<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s1>&#39;^rc&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span>
</code></pre></div> <p>If we want things tidy, we must know that whenever we <code>apt-get remove</code> a package, the configuration will be kept in case we want to install it again. In most cases we want to use <code>apt-get purge</code>. To clean those configurations from removed packages, we can use</p> <div class=highlight><pre><span></span><code>dpkg<span class=w> </span>--list<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s2>&quot;^rc&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s2>&quot; &quot;</span><span class=w> </span>-f<span class=w> </span><span class=m>3</span><span class=w> </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>--no-run-if-empty<span class=w> </span>sudo<span class=w> </span>dpkg<span class=w> </span>--purge
</code></pre></div> <p>So far we have not uninstalled anything. If now we want to inspect what packages are consuming the most space, we can type</p> <div class=highlight><pre><span></span><code>dpkg-query<span class=w> </span>-Wf<span class=w> </span><span class=s1>&#39;${Installed-Size}\t${Package}\n&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span>-n
</code></pre></div> <h3 id=clean-snap-data><a href=https://www.debugpoint.com/2021/03/clean-up-snap/ >Clean snap data</a><a class=headerlink href=#clean-snap-data title="Permanent link">⚑</a></h3> <p>If you're using <code>snap</code> you can clean space by:</p> <ul> <li> <p>Reduce the number of versions kept of a package with <code>snap set system refresh.retain=2</code></p> </li> <li> <p>Remove the old versions with <code>clean_snap.sh</code></p> </li> </ul> <div class=highlight><pre><span></span><code><span class=ch>#!/bin/bash</span>
<span class=c1>#Removes old revisions of snaps</span>
<span class=c1>#CLOSE ALL SNAPS BEFORE RUNNING THIS</span>
<span class=nb>set</span><span class=w> </span>-eu
<span class=nv>LANG</span><span class=o>=</span>en_US.UTF-8<span class=w> </span>snap<span class=w> </span>list<span class=w> </span>--all<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/disabled/{print $1, $3}&#39;</span><span class=w> </span><span class=p>|</span>
<span class=k>while</span><span class=w> </span><span class=nb>read</span><span class=w> </span>snapname<span class=w> </span>revision<span class=p>;</span><span class=w> </span><span class=k>do</span>
<span class=w>    </span>snap<span class=w> </span>remove<span class=w> </span><span class=s2>&quot;</span><span class=nv>$snapname</span><span class=s2>&quot;</span><span class=w> </span>--revision<span class=o>=</span><span class=s2>&quot;</span><span class=nv>$revision</span><span class=s2>&quot;</span>
<span class=k>done</span>
</code></pre></div> <h3 id=clean-journalctl-data><a href=https://linuxhandbook.com/clear-systemd-journal-logs/ >Clean journalctl data</a><a class=headerlink href=#clean-journalctl-data title="Permanent link">⚑</a></h3> <ul> <li>Check how much space it's using: <code>journalctl --disk-usage</code></li> <li>Rotate the logs: <code>journalctl --rotate</code></li> </ul> <p>Then you have three ways to reduce the data:</p> <ol> <li>Clear journal log older than X days: <code>journalctl --vacuum-time=2d</code></li> <li>Restrict logs to a certain size: <code>journalctl --vacuum-size=100M</code></li> <li>Restrict number of log files: <code>journactl --vacuum-files=5</code>.</li> </ol> <p>The operations above will affect the logs you have right now, but it won't solve the problem in the future. To let <code>journalctl</code> know the space you want to use open the <code>/etc/systemd/journald.conf</code> file and set the <code>SystemMaxUse</code> to the amount you want (for example <code>1000M</code> for a gigabyte). Once edited restart the service with <code>sudo systemctl restart systemd-journald</code>.</p> <h3 id=clean-up-docker-data>Clean up docker data<a class=headerlink href=#clean-up-docker-data title="Permanent link">⚑</a></h3> <p>To remove unused <code>docker</code> data you can run <code>docker system prune -a</code>. This will remove:</p> <ul> <li>All stopped containers</li> <li>All networks not used by at least one container</li> <li>All images without at least one container associated to them</li> <li>All build cache</li> </ul> <p>Sometimes that's not enough, and your <code>/var/lib/docker</code> directory still weights more than it should. In those cases:</p> <ul> <li>Stop the <code>docker</code> service.</li> <li>Remove or move the data to another directory</li> <li>Start the <code>docker</code> service.</li> </ul> <p>In order not to loose your persisted data, you need to configure your dockers to mount the data from a directory that's not within <code>/var/lib/docker</code>.</p> <h4 id=set-up-docker-logs-rotation><a href=https://medium.com/free-code-camp/how-to-setup-log-rotation-for-a-docker-container-a508093912b2>Set up docker logs rotation</a><a class=headerlink href=#set-up-docker-logs-rotation title="Permanent link">⚑</a></h4> <p>By default, the stdout and stderr of the container are written in a JSON file located in <code>/var/lib/docker/containers/[container-id]/[container-id]-json.log</code>. If you leave it unattended, it can take up a large amount of disk space.</p> <p>If this JSON log file takes up a significant amount of the disk, we can purge it using the next command.</p> <div class=highlight><pre><span></span><code>truncate<span class=w> </span>-s<span class=w> </span><span class=m>0</span><span class=w> </span>&lt;logfile&gt;
</code></pre></div> <p>We could setup a cronjob to purge these JSON log files regularly. But for the long term, it would be better to setup log rotation. This can be done by adding the following values in <code>/etc/docker/daemon.json</code>.</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;log-driver&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;json-file&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;log-opts&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;max-size&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;10m&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;max-file&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;10&quot;</span>
<span class=w>  </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <h3 id=clean-old-kernels><a href=https://tuxtweaks.com/2010/10/remove-old-kernels-in-ubuntu-with-one-command/ >Clean old kernels</a><a class=headerlink href=#clean-old-kernels title="Permanent link">⚑</a></h3> <p>!!! warning "I don't recommend using this step, rely on <code>apt-get autoremove</code>, it' safer"</p> <p>The full command is</p> <div class=highlight><pre><span></span><code>dpkg<span class=w> </span>-l<span class=w> </span>linux-*<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/^ii/{ print $2}&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-v<span class=w> </span>-e<span class=w> </span><span class=sb>`</span>uname<span class=w> </span>-r<span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-f1,2<span class=w> </span>-d<span class=s2>&quot;-&quot;</span><span class=sb>`</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-e<span class=w> </span><span class=o>[</span><span class=m>0</span>-9<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;(image|headers)&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>sudo<span class=w> </span>apt-get<span class=w> </span>-y<span class=w> </span>purge
</code></pre></div> <p>To test what packages will it remove use:</p> <div class=highlight><pre><span></span><code>dpkg<span class=w> </span>-l<span class=w> </span>linux-*<span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/^ii/{ print $2}&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-v<span class=w> </span>-e<span class=w> </span><span class=sb>`</span>uname<span class=w> </span>-r<span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-f1,2<span class=w> </span>-d<span class=s2>&quot;-&quot;</span><span class=sb>`</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-e<span class=w> </span><span class=o>[</span><span class=m>0</span>-9<span class=o>]</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-e<span class=w> </span><span class=s2>&quot;(image|headers)&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>sudo<span class=w> </span>apt-get<span class=w> </span>--dry-run<span class=w> </span>remove
</code></pre></div> <p>Remember that your running kernel can be obtained by <code>uname -r</code>.</p> <h2 id=replace-a-string-with-sed-recursively><a href=https://victoria.dev/blog/how-to-replace-a-string-with-sed-in-current-and-recursive-subdirectories/ >Replace a string with sed recursively</a><a class=headerlink href=#replace-a-string-with-sed-recursively title="Permanent link">⚑</a></h2> <div class=highlight><pre><span></span><code>find<span class=w> </span>.<span class=w> </span>-type<span class=w> </span>f<span class=w> </span>-exec<span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;s/foo/bar/g&#39;</span><span class=w> </span><span class=o>{}</span><span class=w> </span>+
</code></pre></div> <h2 id=bypass-client-ssl-certificate-with-cli-tool>Bypass client SSL certificate with cli tool<a class=headerlink href=#bypass-client-ssl-certificate-with-cli-tool title="Permanent link">⚑</a></h2> <p>Websites that require clients to authorize with an TLS certificate are difficult to interact with through command line tools that don't support this feature.</p> <p>To solve it, we can use a transparent proxy that does the exchange for us.</p> <ul> <li>Export your certificate: If you have a <code>p12</code> certificate, you first need to extract the key, crt and the ca from the certificate into the <code>site.pem</code>.</li> </ul> <div class=highlight><pre><span></span><code>openssl<span class=w> </span>pkcs12<span class=w> </span>-in<span class=w> </span>certificate.p12<span class=w> </span>-out<span class=w> </span>site.key.pem<span class=w> </span>-nocerts<span class=w> </span>-nodes<span class=w> </span><span class=c1># It asks for the p12 password</span>
openssl<span class=w> </span>pkcs12<span class=w> </span>-in<span class=w> </span>certificate.p12<span class=w> </span>-out<span class=w> </span>site.crt.pem<span class=w> </span>-clcerts<span class=w> </span>-nokeys
openssl<span class=w> </span>pkcs12<span class=w> </span>-cacerts<span class=w> </span>-nokeys<span class=w> </span>-in<span class=w> </span>certificate.p12<span class=w> </span>-out<span class=w> </span>site-ca-cert.ca

cat<span class=w> </span>site.key.pem<span class=w> </span>site.crt.pem<span class=w> </span>site-ca-cert.ca<span class=w> </span>&gt;<span class=w> </span>site.pem
</code></pre></div> <ul> <li>Build the proxy ca: Then we merge the site and the client ca's into the <code>site-ca-file.cert</code> file:</li> </ul> <div class=highlight><pre><span></span><code>openssl<span class=w> </span>s_client<span class=w> </span>-connect<span class=w> </span>www.site.org:443<span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=w>  </span><span class=p>|</span><span class=w> </span>openssl<span class=w> </span>x509<span class=w> </span>-text<span class=w> </span>&gt;<span class=w> </span>site-ca-file.cert
cat<span class=w> </span>site-ca-cert.ca<span class=w> </span>&gt;&gt;<span class=w> </span>web-ca-file.cert
</code></pre></div> <ul> <li>Change your hosts file to redirect all requests to the proxy.</li> </ul> <div class=highlight><pre><span></span><code># <span class=k>vim</span> <span class=sr>/etc/</span>hosts
[...]
<span class=m>0</span>.<span class=m>0</span>.<span class=m>0</span>.<span class=m>0</span> www.site.org
</code></pre></div> <ul> <li>Run the proxy</li> </ul> <div class=highlight><pre><span></span><code>docker<span class=w> </span>run<span class=w> </span>--rm<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-v<span class=w> </span><span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span>:/certs/<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-p<span class=w> </span><span class=m>3001</span>:3001<span class=w> </span><span class=se>\</span>
<span class=w>    </span>-it<span class=w> </span>ghostunnel/ghostunnel<span class=w> </span><span class=se>\</span>
<span class=w>    </span>client<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--listen<span class=w> </span><span class=m>0</span>.0.0.0:3001<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--target<span class=w> </span>www.site.org:443<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--keystore<span class=w> </span>/certs/site.pem<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--cacert<span class=w> </span>/certs/site-ca-file.cert<span class=w> </span><span class=se>\</span>
<span class=w>    </span>--unsafe-listen
</code></pre></div> <ul> <li>Run the command line tool using the http protocol on the port 3001:</li> </ul> <div class=highlight><pre><span></span><code>wpscan<span class=w>  </span>--url<span class=w> </span>http://www.site.org:3001/<span class=w> </span>--disable-tls-checks
</code></pre></div> <p>Remember to clean up your env afterwards.</p> <h2 id=allocate-space-for-a-virtual-filesystem><a href=https://askubuntu.com/questions/506910/creating-a-large-size-file-in-less-time>Allocate space for a virtual filesystem</a><a class=headerlink href=#allocate-space-for-a-virtual-filesystem title="Permanent link">⚑</a></h2> <p>Also useful to simulate big files</p> <div class=highlight><pre><span></span><code>fallocate<span class=w> </span>-l<span class=w> </span>20G<span class=w> </span>/path/to/file
</code></pre></div> <h2 id=identify-what-a-string-or-file-contains><a href=https://github.com/bee-san/pyWhat>Identify what a string or file contains</a><a class=headerlink href=#identify-what-a-string-or-file-contains title="Permanent link">⚑</a></h2> <p>Identify anything. <code>pyWhat</code> easily lets you identify emails, IP addresses, and more. Feed it a .pcap file or some text and it'll tell you what it is.</p> <h2 id=split-a-file-into-many-with-equal-number-of-lines><a href=https://stackoverflow.com/questions/2016894/how-to-split-a-large-text-file-into-smaller-files-with-equal-number-of-lines>Split a file into many with equal number of lines</a><a class=headerlink href=#split-a-file-into-many-with-equal-number-of-lines title="Permanent link">⚑</a></h2> <p>You could do something like this:</p> <div class=highlight><pre><span></span><code>split<span class=w> </span>-l<span class=w> </span><span class=m>200000</span><span class=w> </span>filename
</code></pre></div> <p>Which will create files each with 200000 lines named <code>xaa</code>, <code>xab</code>, <code>xac</code>, ...</p> <h2 id=check-if-an-rsync-command-has-gone-well>Check if an rsync command has gone well<a class=headerlink href=#check-if-an-rsync-command-has-gone-well title="Permanent link">⚑</a></h2> <p>Sometimes after you do an <code>rsync</code> between two directories of different devices (an usb and your hard drive for example), the sizes of the directories don't match. I've seen a difference of a 30% less on the destination. <code>du</code>, <code>ncdu</code> and <code>and</code> have a long story of reporting wrong sizes with advanced filesystems (ZFS, VxFS or compressing filesystems), these do a lot of things to reduce the disk usage (deduplication, compression, extents, files with holes...) which may lead to the difference in space.</p> <p>To check if everything went alright run <code>diff -r --brief source/ dest/</code>, and check that there is no output.</p> <h2 id=list-all-process-swap-usage><a href=https://www.cyberciti.biz/faq/linux-which-process-is-using-swap/ >List all process swap usage</a><a class=headerlink href=#list-all-process-swap-usage title="Permanent link">⚑</a></h2> <div class=highlight><pre><span></span><code><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span>/proc/*/status<span class=w> </span><span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span>awk<span class=w> </span><span class=s1>&#39;/VmSwap|Name/{printf $2 &quot; &quot; $3}END{ print &quot;&quot;}&#39;</span><span class=w> </span><span class=nv>$file</span><span class=p>;</span><span class=w> </span><span class=k>done</span><span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span>-k<span class=w> </span><span class=m>2</span><span class=w> </span>-n<span class=w> </span>-r<span class=w> </span><span class=p>|</span><span class=w> </span>less
</code></pre></div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2024-08-30T08:35:48+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-08-30</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/benkyonodo target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.instant", "navigation.top", "content.code.annotate", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.8fd75fb4.min.js></script> <script src=../js/timeago.min.js></script> <script src=../js/timeago_mkdocs_material.js></script> </body> </html>